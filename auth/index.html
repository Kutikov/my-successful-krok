<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>My successful KROK account</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <meta name="description" content="">
    <meta name="author" content="Damir A. Kutikov">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="FireBaseAPI.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

</head>

<body style="background-image: url('white_image.png'); background-size: cover;">
    <div style="display: flex; bottom: 0; top: 0; right: 0; left: 0; position: absolute; flex-direction: column; align-items: center;">
        <div style="display: flex; flex-direction: row; align-items: center; flex-grow: 0; flex-shrink: 0; flex-wrap: wrap; background-color: #fff; z-index: 100; box-shadow: 0px 0px 8px 4px #0006; width: 100%;">
            <div style="margin: 16px 8px 8px 16px; height: 48px; width: 48px; background-image: url('ic_launcher.png'); background-size: contain; flex-grow: 0; flex-shrink: 0;"></div> 
            <p class="card__text" id="pageTitle" style="font-size: 28px; font-weight: 500; flex-grow: 1; margin-left: 16px;"></p>
            <div style="display: flex; flex-direction: row; margin-right: 8px; margin-left: 8px; flex-grow: 0; flex-shrink: 0; flex-wrap: nowrap;">
                <button class="mdc-button mdc-button--outlined" style="margin: 8px" onclick="localize(0)">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label">ua</span>
                </button>
                <button class="mdc-button mdc-button--outlined" style="margin: 8px" onclick="localize(2)">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label">en</span>
                </button>
                <button class="mdc-button mdc-button--outlined" style="margin: 8px" onclick="localize(1)">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label">ru</span>
                </button>
            </div>
        </div>
        <div id="listMainPage" class="listMainPage">
            <div class='mdc-card' id="cardLogin" style="margin: 16px; background-color: #fff;">
                <div style="display:flex; flex-direction: row; flex-wrap: nowrap; margin-bottom: 8px; justify-content: space-between; align-items: center;">
                    <p class="card__text" style="font-size: 22px; color: #000;" id="loginingTitle">ВХІД</p>
                    <button class="mdc-button mdc-button--outlined" style="margin: 8px 16px;" onclick="changeCard('register')" id="registartionButtonB">
                        <span class="mdc-button__ripple"></span>
                        <i class="material-icons mdc-button__icon" aria-hidden="true">how_to_reg</i>
                        <span class="mdc-button__label" id="registartionButton">Реєстрація</span>
                    </button>
                </div>
                <label class="mdc-text-field mdc-text-field--outlined" id="emailLoginH" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" id="emailLoginLabel">Email</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="text" id="emailLogin" class="mdc-text-field__input" required pattern="[-a-zA-Z0-9~!$%^&amp;*_=+}{'?]+(\.[-a-zA-Z0-9~!$%^&amp;*_=+}{'?]+)*@([a-zA-Z0-9_][-a-zA-Z0-9_]*(\.[-a-zA-Z0-9_]+)*\.([cC][oO][mM]))(:[0-9]{1,5})?">
                </label>
                <label class="mdc-text-field mdc-text-field--outlined" id="passwordLoginH" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" id="passwordLoginLabel">Пароль</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="password" id="passwordLogin" class="mdc-text-field__input" required minlength="8">
                </label>
                <div role="progressbar" id="loginProgress" style="width: 100%; display: none;" class="mdc-linear-progress mdc-linear-progress--indeterminate" aria-label="Example Progress Bar" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0">
                    <div class="mdc-linear-progress__buffer">
                        <div class="mdc-linear-progress__buffer-bar"></div>
                        <div class="mdc-linear-progress__buffer-dots"></div>
                    </div>
                    <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
                        <span class="mdc-linear-progress__bar-inner"></spa>
                    </div>
                    <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
                        <span class="mdc-linear-progress__bar-inner"></span>
                    </div>
                </div>
                <p class="card__text" id="consoleLogin" style="color: #b00020; display: none;"></p>
                <div class="mdc-card__actions">
                    <div class="mdc-card__action-buttons" onclick="loginIn()">
                        <button class="mdc-button mdc-card__action mdc-card__action--button" id="loginButtonB">
                            <div class="mdc-button__ripple"></div>
                            <span class="mdc-button__label" id='loginButton'>Увійти</span>
                        </button>
                    </div>
                    <div class="mdc-card__action-buttons" onclick="resetPass()">
                        <button class="mdc-button mdc-card__action mdc-card__action--button" id="resetButtonB">
                            <div class="mdc-button__ripple"></div>
                            <span class="mdc-button__label" id='resetButton'>Скинути пароль</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class='mdc-card' id="cardRegister" style="margin: 16px; background-color: #fff;">
                <div style="display:flex; flex-direction: row; flex-wrap: nowrap; margin-bottom: 8px; justify-content: space-between; align-items: center;">
                    <p class="card__text" style="font-size: 22px; color: #000;" id="registartionTitle">РЕЄСТРАЦІЯ</p>
                    <button class="mdc-button mdc-button--outlined" onclick="changeCard('login')"  style="margin: 8px 16px;" id="loginingButtonB">
                        <span class="mdc-button__ripple"></span>
                        <i class="material-icons mdc-button__icon" aria-hidden="true">vpn_key</i>
                        <span class="mdc-button__label" id="loginingButton">Вхід</span>
                    </button>
                </div>
                <label class="mdc-text-field mdc-text-field--outlined" id="nameRegisterH" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" id="nameRegisterLabel">Логін у додатку</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="text" id="nameRegister" class="mdc-text-field__input" required minlength="4">
                </label>
                <label class="mdc-text-field mdc-text-field--outlined" id="emailRegisterH" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" id="emailRegisterLabel">Email</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="text" id="emailRegister" class="mdc-text-field__input" required pattern="[-a-zA-Z0-9~!$%^&amp;*_=+}{'?]+(\.[-a-zA-Z0-9~!$%^&amp;*_=+}{'?]+)*@([a-zA-Z0-9_][-a-zA-Z0-9_]*(\.[-a-zA-Z0-9_]+)*\.([cC][oO][mM]))(:[0-9]{1,5})?">
                </label>
                <label class="mdc-text-field mdc-text-field--outlined" id="passwordRegister1H" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" id="passwordRegister1Label">Пароль</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="password" id="passwordRegister1" class="mdc-text-field__input" required minlength="8">
                </label>
                <label class="mdc-text-field mdc-text-field--outlined" id="passwordRegister2H" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" id="passwordRegister2Label">Повторити пароль</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="password" id="passwordRegister2" class="mdc-text-field__input" required minlength="8">
                </label>
                <div class="mdc-form-field" style="margin-left: 8px;">
                    <div class="mdc-checkbox">
                        <input type="checkbox" class="mdc-checkbox__native-control" id="checkboxConsent"/>
                        <div class="mdc-checkbox__background">
                            <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
                                <path class="mdc-checkbox__checkmark-path" fill="none" d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
                            </svg>
                        <div class="mdc-checkbox__mixedmark"></div>
                        </div>
                        <div class="mdc-checkbox__ripple"></div>
                    </div>
                    <label for="checkboxConsent" id="checkboxConsentLabel">Я погоджуюся з <a target="_blank" href="https://google.com.ua">правилами користування</a> цього додатку</label>
                </div>
                <div role="progressbar" id="registerProgress" style="width: 100%; display: none;" class="mdc-linear-progress mdc-linear-progress--indeterminate" aria-label="Example Progress Bar" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0">
                    <div class="mdc-linear-progress__buffer">
                        <div class="mdc-linear-progress__buffer-bar"></div>
                        <div class="mdc-linear-progress__buffer-dots"></div>
                    </div>
                    <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
                        <span class="mdc-linear-progress__bar-inner"></spa>
                    </div>
                    <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
                        <span class="mdc-linear-progress__bar-inner"></span>
                    </div>
                </div>
                <p class="card__text" id="consoleRegister" style="color: #b00020; display: none;"></p>
                <div class="mdc-card__actions">
                    <div class="mdc-card__action-buttons" onclick="register()">
                        <button class="mdc-button mdc-card__action mdc-card__action--button" id="registerButtonB">
                            <div class="mdc-button__ripple"></div>
                            <span class="mdc-button__label" id='registerButton'>Зареєструватися</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class='mdc-card' id="cardSuccess" style="margin: 16px; background-color: #fff;">
                <div style="display: flex; flex-direction: column; margin: 16px; align-items: center;">
                    <div style="height: 256px; width: 256px; background-image: url('success.jpg'); background-size: contain;"></div>
                    <p class="card__text" id="successfulTitle" style="color: #000; width: 100%; text-align: center; font-size: 22px; font-weight: 600;"></p>
                    <p class="card__text" id="consoleSuccess" style="color: #333; width: 100%; text-align: justify;"></p>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        const localization = {
            loginingTitle: ['ВХІД', 'ВХОД', 'SIGNING IN'],
            registartionButton: ['Реєстрація', 'Регистрация', 'Registration'],
            emailLoginLabel: ['Email', 'Email', 'Email'],
            passwordLoginLabel: ['Пароль', 'Пароль', 'Password'],
            loginButton: ['Увійти', 'Войти', 'Sign in'],
            resetButton: ['Скинути пароль', 'Сбросить пароль', 'Reset password'],
            registartionTitle: ['РЕЄСТРАЦІЯ', 'РЕГИСТРАЦИЯ', 'REGISTRATION'],
            loginingButton: ['Вхід', 'Вход', 'Signing in'],
            nameRegisterLabel: ['Ім\'я у додатку', 'Имя в приложении', 'Name in app'],
            emailRegisterLabel: ['Email', 'Email', 'Email'],
            passwordRegister1Label: ['Пароль (8 знаків)', 'Пароль (8 знаков)', 'Password (8 symbols)'],
            passwordRegister2Label: ['Повторити пароль', 'Повторить пароль', 'Repeat password'],
            checkboxConsentLabel: ['Я погоджуюся з <a target="_blank" href="https://google.com.ua">правилами користування</a> цього додатку', 'Я соглашаюсь с <a target="_blank" href="https://google.com.ua">правилами пользования</a> этого приложения', 'I agree to the <a target="_blank" href="https://google.com.ua">terms of use</a> for this application'],
            registerButton: ['Зареєструватися', 'Зарегистрироваться', 'Register'],
            pageTitle: ['Мій успішний КРОК', 'Мой успешный КРОК', 'My successful KROK'],
            successfulTitle: ['Успішно!', 'Успешно!', 'Successfully!'],
        };

        const messages = {
            emptyName: ['Некоректне ім\'я', 'Некорректное имя', 'Incorrect name'],
            needVerification: ['Вам на пошту надійшов лист з посиланням для підтверждення реєстрації. Відкрийте його та натисніть на посилання.', 'Вам на почту пришло письмо со ссылкой для подтверждения регистрации. Откройте его и нажмите на ссылку.', 'You have received an email with a link to confirm registration. Open it and click on the link.'],
            weakPassword: ["Пароль недостатньо надійний", 'Пароль недостаточно надежен', 'The password is not strong enough'],
            duplicateEmail: ["Користувач з такою email адресою вже зареєстрований", 'Пользователь с таким email адресу уже зарегистрирован', 'A user with this email address is already registered'],
            emptyEmail: ["Некоректний email", 'Некорректный email', 'Incorrect email'],
            logedIn: ["Ви успішно увійшли в акаунт! Не забудьте також увійти на Ваших 2 пристроях з додатком Мій успішний КРОК.", 'Вы успешно вошли в аккаунт! Не забудьте также войти на Ваших 2 устройствах с приложением Мой успешный КРОК.', 'You have successfully logged in! Don\'t forget to sign in on your 2 devices with the My Successful KROK app.'],
            wrongPassword: ["Невірний пароль", 'Неверный пароль', 'Invalid password'],
            notFoundEmail: ["Користувача з такою поштою не знайдено", 'Пользователя с таким почте не найдено', 'No user with this mail was found'],
            expiredTermReresetPass: ["Нажаль вийшов термін коду скидання пароля, скиньте пароль іще раз", 'К сожалению вышел срок кода сброса пароля, сбросьте пароль еще раз', 'Sorry, the password reset code has expired, reset your password again'],
            passwordEmailSended: ["Вам надіслано на пошту лист з посиланням для скидання пароля. Відкрийте його та натисніть на посилання.", 'Вам отправлено на почту письмо со ссылкой для сброса пароля. Откройте его и нажмите на ссылку.', 'You have received an email with a link to reset your password. Open it and click on the link.'],
            enterNewPassword: ["Введіть новий пароль", 'Введите новий пароль', 'Enter a new password'],
            expiredTermReregister: ["Нажаль вийшов термін підтвердження акаунту. Вам на пошту щойно надійшов лист з посиланням для підтверждення реєстрації. Відкрийти його та натисніть на посилання.", 'К сожалению вышел срок подтверждения аккаунта. Вам на почту только пришло письмо со ссылкой для подтверждения регистрации. Видкрийты его и нажмите на ссылку.', 'Sorry, your account verification deadline has expired. You have just received an email with a link to confirm registration. Open it and click on the link.'],
            emailVerified: ["Вашу пошту підтвержено! Тепер Ви маєте повний доступ до всієї платформи. Не забудьте також увійти на Ваших 2 пристроях з додатком Мій успішний КРОК.", 'Почта подтверждена! Теперь Вы имеете полный доступ ко всей платформы. Не забудьте также войти на Ваших 2 устройствах с приложением Мой успешный КРОК.', 'Your mail has been confirmed! You now have full access to the entire platform. Don\'t forget to sign in on your 2 devices with the My Successful KROK app.'],
            emptyPassword: ["Некоректний пароль", 'Некорректный пароль', 'Incorrect password'],
            emptyPassword2: ["Некоректно повторений пароль", 'Некорректно повторен пароль', 'Incorrectly repeated password'],
            passwordMismatch: ["Паролі не співпадають", 'Пароли не совпадают', 'Passwords do not match'],
            agreeConsent: ["Підтвердьте, що згодні з умовами користування додатком", 'Подтвердите, что согласны с условиями пользования приложением', 'Confirm that you agree to the terms of use of the application']
        };

        let message = ''
        let lang = 0;
        let updatePassword = false;
        const selector = '.mdc-button, .mdc-fab, .mdc-icon-button, .mdc-card__primary-action, .mdc-icon-button';
        const ripples = [].map.call(document.querySelectorAll(selector), function (el) {
            return new mdc.ripple.MDCRipple(el);
        });
        const texts = [].map.call(document.querySelectorAll('.mdc-text-field'), function(el) {
            return new mdc.textField.MDCTextField(el);
        });
        const fields = [].map.call(document.querySelectorAll('.mdc-form-field'), function(el) {
            return new mdc.formField.MDCFormField(el);
        });
        const checks = [].map.call(document.querySelectorAll('.mdc-checkbox'), function(el) {
            return new mdc.checkbox.MDCCheckbox(el);
        });
        const progresses = [].map.call(document.querySelectorAll('.mdc-linear-progress'), function(el) {
            return new mdc.linearProgress.MDCLinearProgress(el);
        });
        const loginCard = document.getElementById('cardLogin');
        const registerCard = document.getElementById('cardRegister');
        const successCard = document.getElementById('cardSuccess');
        const loginConsole = document.getElementById('consoleLogin');
        const registerConsole = document.getElementById('consoleRegister');
        const successConsole = document.getElementById('consoleSuccess');

        const firebaseApi = new FireBaseAPI();

        document.addEventListener('DOMContentLoaded', () => {
            localize(0);
            changeCard('register');
        });

        function localize(langInt){
            lang = langInt;
            for(let str in localization){
                document.getElementById(str).innerHTML = localization[str][lang];
            }
            if(message !== ''){
                showMessage(message);
            }
        }

        function verifyField(id){
            if(!document.getElementById(id).classList.contains('mdc-text-field--invalid')){
                return document.getElementById(id.substring(0, id.length - 1)).value;
            }
            return false;
        }

        function loginIn(){
            const email = verifyField('emailLoginH');
            const password = verifyField('passwordLoginH');
            if(!email){
                showMessage('emptyEmail');
                return;
            }
            if(!password){
                showMessage('emptyPassword');
                return;
            }
            firebaseApi.login(email, password);
            document.getElementById('registartionButtonB').disabled = true;
            document.getElementById('loginButtonB').disabled = true;
            document.getElementById('resetButtonB').disabled = true;
            document.getElementById('loginProgress').style.display = 'block';
        }

        function resetPass(){
            const email = verifyField('emailLoginH');
            const password = verifyField('passwordLoginH');
            if(!email){
                showMessage('emptyEmail');
                return;
            }
            if(!password && updatePassword){
                showMessage('emptyPassword');
                return;
            }
            firebaseApi.resetPass(email, password, updatePassword);
            document.getElementById('registartionButtonB').disabled = true;
            document.getElementById('loginButtonB').disabled = true;
            document.getElementById('resetButtonB').disabled = true;
            document.getElementById('loginProgress').style.display = 'block';
        }

        function register(){
            const name = verifyField('nameRegisterH');
            const email = verifyField('emailRegisterH');
            const password1 = verifyField('passwordRegister1H');
            const password2 = verifyField('passwordRegister2H');
            if(!name){
                showMessage('emptyName');
                return;
            }
            if(!email){
                showMessage('emptyEmail');
                return;
            }
            if(!password1){
                showMessage('emptyPassword');
                return;
            }
            if(!password2){
                showMessage('emptyPassword');
                return;
            }
            if(password1 !== password2){
                showMessage('passwordMismatch');
                return;
            }
            if(!document.getElementById('checkboxConsent').checked){
                showMessage('agreeConsent');
                return;
            }
            firebaseApi.register(email, password1, name);
            document.getElementById('loginingButtonB').disabled = true;
            document.getElementById('registerButtonB').disabled = true;
            document.getElementById('registerProgress').style.display = 'block';
        }

        function showMessage(message1){
            message = message1;
            loginConsole.style.display = 'block';
            successConsole.style.display = 'block';
            registerConsole.style.display = 'block';
            document.getElementById('loginProgress').style.display = 'none';
            document.getElementById('registerProgress').style.display = 'none';
            loginConsole.innerHTML = messages[message][lang];
            successConsole.innerHTML = messages[message][lang];
            registerConsole.innerHTML = messages[message][lang];
            document.getElementById('registartionButtonB').disabled = false;
            document.getElementById('loginButtonB').disabled = false;
            document.getElementById('resetButtonB').disabled = false;
        }

        function changeCard(type){
            message = '';
            loginCard.style.display = 'none';
            successCard.style.display = 'none';
            registerCard.style.display = 'none';
            loginConsole.style.display = 'none';
            successConsole.style.display = 'none';
            registerConsole.style.display = 'none';
            document.getElementById('loginProgress').style.display = 'none';
            document.getElementById('registerProgress').style.display = 'none';
            switch(type){
                case 'register':
                    registerCard.style.display = 'flex';
                    break;
                case 'login':
                    loginCard.style.display = 'flex';
                    break;
                case 'success':
                    successCard.style.display = 'flex';
                    break;
            }
        }

    </script>
</body>

</html>