<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>My successful KROK account</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <meta name="description" content="">
    <meta name="author" content="Damir A. Kutikov">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <link href="material.css" rel="stylesheet">
    <script src="material.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="User.js?id=123"></script>
    <script src="https://kutikov.github.io/my-successful-krok/console/buckets/Bucket.js"></script>
    <script type="text/javascript" src="date.js"></script>
    <script src="FireBaseAPI.js?id=123"></script>
    <link rel="stylesheet" href="style.css">
</head>

</head>

<body style="background-image: url('white_image.png'); background-size: cover;">
    <div id="main" style="display: flex; bottom: 0; top: 0; right: 0; left: 0; position: absolute; flex-direction: column; align-items: center;">
        <div id="panel-top" style="display: flex; flex-direction: row; align-items: center; flex-grow: 0; flex-shrink: 0; flex-wrap: wrap; background-color: #fff; z-index: 100; width: 100%;">
            <div id="icon" style="margin: 12px 8px 8px 12px; height: 32px; width: 32px; background-image: url('ic_launcher.png'); background-size: contain; flex-grow: 0; flex-shrink: 0;"></div> 
            <p class="card__text" id="pageTitle" style="font-size: 22px; font-weight: 500; flex-grow: 1; margin-left: 16px;"></p>
            <div style="display: flex; flex-direction: row; margin-right: 8px; margin-left: 8px; flex-grow: 0; flex-shrink: 0; flex-wrap: nowrap;">
                <button class="mdc-button mdc-button--outlined" style="margin: 8px" onclick="localize(0)">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label">ua</span>
                </button>
                <button class="mdc-button mdc-button--outlined" style="margin: 8px" onclick="localize(2)">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label">en</span>
                </button>
                <button class="mdc-button mdc-button--outlined" style="margin: 8px" onclick="localize(1)">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label">ru</span>
                </button>
            </div>
        </div>
        <div id="listMainPage" class="listMainPage">
            <div class='mdc-card' id="cardQuery" style="margin: 16px; background-color: #fff;">
                <div style="display: flex; flex-direction: row; flex-wrap: nowrap; justify-content: space-between; align-items: flex-start; margin-top: 8px;">
                    <p class="card__text" id="bucketTitle" style="color: #000; width: 10px; text-align: start; font-size: 22px; font-weight: 600; flex-grow: 1; flex-shrink: 1;"></p>
                    <p class="card__text" id="bucketCost" style="color: #000; width: auto; text-align: center; font-size: 22px; font-weight: 600; flex-grow: 0; flex-shrink: 0; color: #006d59"></p>
                </div>
                <p class="card__text" id="bucketDescription" style="color: #333; text-align: justify; margin-top: 0; margin-bottom: 4px;"></p>
                <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start;">
                    <div class="info_item__container">
                        <svg class="info_item__icon" viewBox="0 0 24 24">
                            <path fill="#006d59" d="M12 3C14.21 3 16 4.79 16 7S14.21 11 12 11 8 9.21 8 7 9.79 3 12 3M16 13.54C16 14.6 15.72 17.07 13.81 19.83L13 15L13.94 13.12C13.32 13.05 12.67 13 12 13S10.68 13.05 10.06 13.12L11 15L10.19 19.83C8.28 17.07 8 14.6 8 13.54C5.61 14.24 4 15.5 4 17V21H20V17C20 15.5 18.4 14.24 16 13.54Z" />
                        </svg>
                        <div style="width: 10px; flex-grow: 1; flex-shrink: 1;">
                            <p class="card__text info_item__label" id="beneficiarTitle"></p>
                            <p class="card__text info_item__content" id="beneficiarContent"></p>
                        </div>
                    </div>
                    <div class="info_item__container">
                        <svg class="info_item__icon" viewBox="0 0 24 24">
                            <path fill="#006d59" d="M10.59,13.41C11,13.8 11,14.44 10.59,14.83C10.2,15.22 9.56,15.22 9.17,14.83C7.22,12.88 7.22,9.71 9.17,7.76V7.76L12.71,4.22C14.66,2.27 17.83,2.27 19.78,4.22C21.73,6.17 21.73,9.34 19.78,11.29L18.29,12.78C18.3,11.96 18.17,11.14 17.89,10.36L18.36,9.88C19.54,8.71 19.54,6.81 18.36,5.64C17.19,4.46 15.29,4.46 14.12,5.64L10.59,9.17C9.41,10.34 9.41,12.24 10.59,13.41M13.41,9.17C13.8,8.78 14.44,8.78 14.83,9.17C16.78,11.12 16.78,14.29 14.83,16.24V16.24L11.29,19.78C9.34,21.73 6.17,21.73 4.22,19.78C2.27,17.83 2.27,14.66 4.22,12.71L5.71,11.22C5.7,12.04 5.83,12.86 6.11,13.65L5.64,14.12C4.46,15.29 4.46,17.19 5.64,18.36C6.81,19.54 8.71,19.54 9.88,18.36L13.41,14.83C14.59,13.66 14.59,11.76 13.41,10.59C13,10.2 13,9.56 13.41,9.17Z" />
                        </svg>
                        <div style="width: 10px; flex-grow: 1; flex-shrink: 1;">
                            <p class="card__text info_item__label" id="urlTitle"></p>
                            <p class="card__text info_item__content" id="urlContent"></p>
                        </div>
                    </div>
                    <div class="info_item__container">
                        <svg class="info_item__icon" viewBox="0 0 24 24">
                            <path fill="#006d59" d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z" />
                        </svg>
                        <div style="width: 10px; flex-grow: 1; flex-shrink: 1;">
                            <p class="card__text info_item__label" id="ttlTitle"></p>
                            <p class="card__text info_item__content" id="ttlContent"></p>
                        </div>
                    </div>
                    <div class="info_item__container">
                        <svg class="info_item__icon" viewBox="0 0 24 24">
                            <path fill="#006d59" d="M15,13H16.5V15.82L18.94,17.23L18.19,18.53L15,16.69V13M19,8H5V19H9.67C9.24,18.09 9,17.07 9,16A7,7 0 0,1 16,9C17.07,9 18.09,9.24 19,9.67V8M5,21C3.89,21 3,20.1 3,19V5C3,3.89 3.89,3 5,3H6V1H8V3H16V1H18V3H19A2,2 0 0,1 21,5V11.1C22.24,12.36 23,14.09 23,16A7,7 0 0,1 16,23C14.09,23 12.36,22.24 11.1,21H5M16,11.15A4.85,4.85 0 0,0 11.15,16C11.15,18.68 13.32,20.85 16,20.85A4.85,4.85 0 0,0 20.85,16C20.85,13.32 18.68,11.15 16,11.15Z" />
                        </svg>
                        <div style="width: 10px; flex-grow: 1; flex-shrink: 1;">
                            <p class="card__text info_item__label" id="upToTitle"></p>
                            <p class="card__text info_item__content" id="upToContent"></p>
                        </div>
                    </div>
                </div>
                <p class="card__text" id="bucketRestirction" style="color: #333; text-align: justify; margin-top: 0;"></p>
                <button class="mdc-button mdc-button--raised" style="margin: 0 16px 16px 16px;" id="processButton" onclick="process()">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label" id="processButtonT">Реєстрація</span>
                </button>
            </div>
            <div class='mdc-card' id="cardSuccess" style="margin: 16px; background-color: #fff;">
                <div style="display: flex; flex-direction: column; margin: 16px; align-items: center;">
                    <div id="iconStatus" style="height: 256px; width: 256px; background-image: url('success.jpg'); background-size: contain;"></div>
                    <p class="card__text" id="successfulTitle" style="color: #000; width: 100%; text-align: center; font-size: 22px; font-weight: 600;"></p>
                    <p class="card__text" id="consoleSuccess" style="color: #333; width: 100%; text-align: justify;"></p>
                </div>
            </div>
            <div class='mdc-card' id="cardLoading" style="margin: 16px; background-color: #fff;">
                <div style="display: flex; flex-direction: column; margin: 16px; align-items: center;">
                    <div style="height: 256px; width: 256px; background-image: url('wait.jpg'); background-size: contain;"></div>
                    <p class="card__text" id="loadingTitle" style="color: #000; width: 100%; text-align: center; font-size: 22px; font-weight: 600;"></p>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        //?language=ua&theme=dark&bucketId=1630266739404&userEmail=iv.ser.volov@gmail.com&serverId=kharkiv2
        const localization = {
            beneficiarTitle: ['Автор', 'Автор', 'Author'],
            urlTitle: ['Сайт автора', 'Сайт автора', 'Author`s site'],
            ttlTitle: ['Час підписки', 'Время подписки', 'Subscription term'],
            upToTitle: ['Буде доступний до', 'Будет доступен до', 'Will be active up to'],
            //cancelButtonT: ['Відміна', 'Отмена', 'Cancel'],
            processButtonT: ['До сплати', 'К оплате', 'To payment'],
            bucketRestirction: ['Зверніть увагу, що після закінчення періоду підписки Ваші успіхи залишаться. Тому якщо Ви захочите подовжити вивчання цього курсу, просто купуйте підписку ще раз.', 'Обратите внимание, что после окончания периода подписки Ваши успехи останутся. Поэтому если Вы захотите продлить изучение этого курса, просто покупайте подписку еще раз.', 'Please note that after the subscription period, your success will remain. So if you want to continue studying this course, just buy a subscription again.'],

            pageTitle: ['Мій успішний КРОК', 'Мой успешный КРОК', 'My successful KROK'],
            successfulTitle: ['Успішно!', 'Успешно!', 'Successfully!'],
            loadingTitle: ['Будь ласка, зачекайте, йде ініціалізація...', 'Пожалуйста, подождите, идет инициализация...', 'Please wait, initialization...']
        };

        
        const messages = {
            ttl: [' місяців', ' месяцев', ' month'],
            acceptTitle: ['Поздоровляємо!', 'Поздравляем!', 'Congratulations!'],
            acceptMessage: ['Всі операції були успішно закінчені. Для отримання контенту просто відкрийте додаток "Мій КРОК наставник" та перейдіть до курсів. Все інше ми зробимо за Вас.', 'Все операции были успешно окончены. Для получения контента просто откройте приложение "Мой КРОК наставник" и перейдите к курсам. Все остальное мы сделаем за Вас.', 'All operations were successfully completed. To get the content, just open the "My KROK Tutor" application and go to the courses. Everything else we will do for you.'],/*+*/
            rejectTitle: ['Упс! Щось пішло не так...', 'Упс! Что-то пошло не так...', 'Oops! Something went wrong ...'],
            rejectMessage: ['Нажаль операція була неуспішною. Зверніться до адміністратора, написавши електронного листа з описом всього, що Ви робили, за адресою damirkut@gmail.com.', 'К сожалению, операция была неуспешной. Обратитесь к администратору, написав электронное письмо с описанием всего, что Вы делали, по адресу damirkut@gmail.com.', 'Unfortunately, the operation was unsuccessful. Contact the administrator by writing an email describing everything you did at damirkut@gmail.com.'],/*+*/
        };

        let lang = 0;
        const selector = '.mdc-button, .mdc-fab, .mdc-icon-button, .mdc-card__primary-action, .mdc-icon-button';
        const ripples = [].map.call(document.querySelectorAll(selector), function (el) {
            return new mdc.ripple.MDCRipple(el);
        });
        const fields = [].map.call(document.querySelectorAll('.mdc-form-field'), function(el) {
            return new mdc.formField.MDCFormField(el);
        });
        const checks = [].map.call(document.querySelectorAll('.mdc-checkbox'), function(el) {
            return new mdc.checkbox.MDCCheckbox(el);
        });

        let type;
        let bucketId;
        let serverId;
        let userEmail;
        let code;
        let bucket;

        const queryCard = document.getElementById('cardQuery');
        const successCard = document.getElementById('cardSuccess');
        const loadingCard = document.getElementById('cardLoading');

        changeCard('loading');
        const firebaseApi = new FireBaseAPI();

        document.addEventListener('DOMContentLoaded', () => {
            firebaseApi.authSecondServer();
            let langI = 0;
            switch(getLanguage()){
                case 'ru':
                    langI = 1;
                    break;
                case 'en':
                    langI = 2;
                    break;
                case 'ua':
                    langI = 0;
                    break;
            }
            localize(langI);
            if(getTheme() == 'dark'){
                document.body.classList.add('body__dark');
                document.getElementById('main').classList.add('main_fragment__dark');
                document.getElementById('icon').classList.add('icon__dark');
                document.getElementById('panel-top').style.boxShadow = 'box-shadow: 0px 0px 8px 4px #fff6;';
                let elems = document.querySelectorAll('.mdc-card');
                for(let i = 0; i < elems.length; i++) {
                    elems[i].style.boxShadow = '0px 2px 1px -1px rgb(255 255 255 / 20%), 0px 1px 1px 0px rgb(255 255 255 / 14%), 0px 1px 3px 0px rgb(255 255 255 / 12%) !important';
                };
            }
            else{
                document.body.classList.add('body__light');
                document.getElementById('main').classList.add('main_fragment__light');
                document.getElementById('icon').classList.add('icon__light');
                document.getElementById('panel-top').style.boxShadow = 'box-shadow: 0px 0px 8px 4px #0006;';
                let elems = document.querySelectorAll('.mdc-card');
                for(let i = 0; i < elems.length; i++) {
                    elems[i].style.boxShadow = '0px 2px 1px -1px rgb(0 0 0 / 20%), 0px 1px 1px 0px rgb(0 0 0 / 14%), 0px 1px 3px 0px rgb(0 0 0 / 12%) !important';
                };
            }
        });

        function localize(langInt){
            lang = langInt;
            for(let str in localization){
                document.getElementById(str).innerHTML = localization[str][lang];
            }
        }

        function getTheme(){
            const url = new URLSearchParams(window.location.search).get('theme');
            if(url == null){
                const cookie = getCookie("theme");
                if(cookie == null){
                    document.cookie = 'theme=light';
                    return 'light';
                }
                return cookie;
            }
            document.cookie = 'theme=' + url;
            return url;
        }

        function getLanguage(){
            const url = new URLSearchParams(window.location.search).get('language');
            if(url == null){
                const cookie = getCookie("language");
                if(cookie == null){
                    document.cookie = 'language=ua';
                    return 'ua';
                }
                return cookie;
            }
            document.cookie = 'language=' + url;
            return url;
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2){
                return parts.pop().split(';').shift();
            } 
            return null;
        }

        function drawBucket(bucketOuter){
            bucket = bucketOuter;
            document.getElementById('bucketTitle').innerText = bucket.name;
            document.getElementById('bucketCost').innerText = bucket.cost;
            document.getElementById('bucketDescription').innerText = bucket.description;
            document.getElementById('beneficiarContent').innerText = bucket.beneficiary;
            document.getElementById('urlContent').innerText = bucket.detailsURL;
            document.getElementById('ttlContent').innerText = bucket.TTL.toString() + messages.ttl[lang];
            document.getElementById('upToContent').innerText = Date.today().addMonths(bucket.TTL).toString("dd.MM.yyyy");
            document.cookie = "code=" + (Number(bucket.cost.split(' ')[0]) + 10000 + 45.575).toString();
            queryCard.style.display = 'flex';
        }

        function process(){
            if(bucket != null){
                window.location.replace(bucket.shopURL);
            }
        }

        function dismiss(){
            window.close();
        }

        function changeCard(localType){
            type = localType
            queryCard.style.display = 'none';
            successCard.style.display = 'none';
            loadingCard.style.display = 'none';
            switch(type){
                case 'loading':
                    loadingCard.style.display = 'flex';
                    break;
                case 'accept':
                case 'reject':
                    code = new URLSearchParams(window.location.search).get('code');
                    userEmail = getCookie('userEmail');
                    bucketId = getCookie('bucketId');
                    serverId = getCookie('serverId');
                    successCard.style.display = 'flex';
                    let success = false;
                    if(type === 'reject' || getCookie('code') !== code){
                        success = false;
                        document.getElementById('iconStatus').style.backgroundImage = 'url("reject.jpg");'
                        document.getElementById('iconStatus').style.filter = 'hue(180deg)';
                        document.getElementById('successfulTitle').innerText = messages.rejectTitle[lang];
                        document.getElementById('consoleSuccess').innerText = messages.rejectMessage[lang];
                    }
                    else{
                        success = true;
                        document.getElementById('iconStatus').style.backgroundImage = 'url("success.jpg");'
                        document.getElementById('iconStatus').style.filter = 'none';
                        document.getElementById('successfulTitle').innerText = messages.acceptTitle[lang];
                        document.getElementById('consoleSuccess').innerText = messages.acceptMessage[lang];
                    }
                    firebaseApi.updateBucketQuery(userEmail, serverId, bucketId, success);
                    break;
                case 'query':
                    code = '';
                    userEmail = new URLSearchParams(window.location.search).get('userEmail');
                    bucketId = new URLSearchParams(window.location.search).get('bucketId');
                    serverId = new URLSearchParams(window.location.search).get('serverId');
                    document.cookie = "userEmail=" + userEmail;
                    document.cookie = "bucketId=" + bucketId;
                    document.cookie = "serverId=" + serverId;
                    if(bucketId == null){
                        const bucket = new Bucket();
                        bucket.name = "Bucket name";
                        bucket.cost = "200 UAH";
                        bucket.description = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. In laoreet, erat eu eleifend sagittis, tellus ligula posuere nisl, vitae ullamcorper eros mauris rutrum mi. In a nisi quam. Sed at mattis metus, vitae dapibus purus. In hac habitasse platea dictumst. Integer nec egestas mi. Proin ornare orci purus, id pharetra risus rhoncus auctor. Quisque dui erat, vulputate egestas ornare eu, imperdiet non libero. Sed suscipit augue eu neque dictum, vitae venenatis nunc vehicula. Mauris imperdiet ex sem, non malesuada purus elementum eget. In molestie ante in ante rhoncus rutrum. In viverra aliquam eros. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nulla vel sagittis nisl, eget laoreet sem.';
                        bucket.beneficiary = 'Alexandr Kozlov';
                        bucket.TTL = 3;
                        bucket.detailsURL = 'https://google.com';
                        bucket.shopURL = 'https://google.com';
                        drawBucket(bucket);
                    }
                    else{
                        loadingCard.style.display = 'flex';
                        firebaseApi.getBucketData(bucketId);
                    }
                    break;
            }
        }
    </script>
</body>

</html>