<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>My successful KROK account</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <meta name="description" content="">
    <meta name="author" content="Damir A. Kutikov">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <link href="material.css" rel="stylesheet">
    <script src="material.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="User.js?id=123"></script>
    <script src="FireBaseAPI.js?id=123"></script>
    <link rel="stylesheet" href="style.css">
</head>

</head>

<body style="background-image: url('white_image.png'); background-size: cover;">
    <div id="main" style="display: flex; bottom: 0; top: 0; right: 0; left: 0; position: absolute; flex-direction: column; align-items: center;">
        <div id="panel-top" style="display: flex; flex-direction: row; align-items: center; flex-grow: 0; flex-shrink: 0; flex-wrap: wrap; background-color: #fff; z-index: 100; width: 100%;">
            <div id="icon" style="margin: 12px 8px 8px 12px; height: 32px; width: 32px; background-image: url('ic_launcher.png'); background-size: contain; flex-grow: 0; flex-shrink: 0;"></div> 
            <p class="card__text" id="pageTitle" style="font-size: 22px; font-weight: 500; flex-grow: 1; margin-left: 16px;"></p>
            <div style="display: flex; flex-direction: row; margin-right: 8px; margin-left: 8px; flex-grow: 0; flex-shrink: 0; flex-wrap: nowrap;">
                <button class="mdc-button mdc-button--outlined" style="margin: 8px" onclick="localize(0)">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label">ua</span>
                </button>
                <button class="mdc-button mdc-button--outlined" style="margin: 8px" onclick="localize(2)">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label">en</span>
                </button>
                <button class="mdc-button mdc-button--outlined" style="margin: 8px" onclick="localize(1)">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label">ru</span>
                </button>
            </div>
        </div>
        <div id="listMainPage" class="listMainPage">
            <div class='mdc-card' id="cardLogin" style="margin: 16px; background-color: #fff;">
                <div style="display:flex; flex-direction: row; flex-wrap: nowrap; margin-bottom: 8px; justify-content: space-between; align-items: center;">
                    <p class="card__text" style="font-size: 22px; color: #000;" id="loginingTitle">ВХІД</p>
                    <button class="mdc-button mdc-button--outlined" style="margin: 8px 16px;" onclick="changeCard('register')" id="registartionButtonB">
                        <span class="mdc-button__ripple"></span>
                        <i class="material-icons mdc-button__icon" aria-hidden="true">how_to_reg</i>
                        <span class="mdc-button__label" id="registartionButton">Реєстрація</span>
                    </button>
                </div>
                <label class="mdc-text-field mdc-text-field--outlined" id="emailLoginH" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" style="transform: translateY(-23px) scale(0.75);"  id="emailLoginLabel">Email</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="text" id="emailLogin" class="mdc-text-field__input" style="margin-top: 6px;" required pattern="[-a-zA-Z0-9~!$%^&amp;*_=+}{'?]+(\.[-a-zA-Z0-9~!$%^&amp;*_=+}{'?]+)*@([a-zA-Z0-9_][-a-zA-Z0-9_]*(\.[-a-zA-Z0-9_]+)*\.([cC][oO][mM]))(:[0-9]{1,5})?">
                </label>
                <label class="mdc-text-field mdc-text-field--outlined" id="passwordLoginH" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label"  style="transform: translateY(-23px) scale(0.75);"  id="passwordLoginLabel">Пароль</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="password" id="passwordLogin" style="margin-top: 6px;"  class="mdc-text-field__input" required minlength="8">
                </label>
                <div role="progressbar" id="loginProgress" style="width: 100%; display: none;" class="mdc-linear-progress mdc-linear-progress--indeterminate" aria-label="Example Progress Bar" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0">
                    <div class="mdc-linear-progress__buffer">
                        <div class="mdc-linear-progress__buffer-bar"></div>
                        <div class="mdc-linear-progress__buffer-dots"></div>
                    </div>
                    <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
                        <span class="mdc-linear-progress__bar-inner"></spa>
                    </div>
                    <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
                        <span class="mdc-linear-progress__bar-inner"></span>
                    </div>
                </div>
                <p class="card__text" id="consoleLogin" style="color: #b00020; display: none;"></p>
                <div class="mdc-card__actions">
                    <div class="mdc-card__action-buttons" onclick="loginIn()">
                        <button class="mdc-button mdc-card__action mdc-card__action--button" id="loginButtonB">
                            <div class="mdc-button__ripple"></div>
                            <span class="mdc-button__label" id='loginButton'>Увійти</span>
                        </button>
                    </div>
                    <div class="mdc-card__action-buttons" onclick="resetPass()">
                        <button class="mdc-button mdc-card__action mdc-card__action--button" id="resetButtonB">
                            <div class="mdc-button__ripple"></div>
                            <span class="mdc-button__label" id='resetButton'>Скинути пароль</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class='mdc-card' id="cardRegister" style="margin: 16px; background-color: #fff;">
                <div style="display:flex; flex-direction: row; flex-wrap: nowrap; margin-bottom: 8px; justify-content: space-between; align-items: center;">
                    <p class="card__text" style="font-size: 22px; color: #000;" id="registartionTitle">РЕЄСТРАЦІЯ</p>
                    <button class="mdc-button mdc-button--outlined" onclick="changeCard('login')"  style="margin: 8px 16px;" id="loginingButtonB">
                        <span class="mdc-button__ripple"></span>
                        <i class="material-icons mdc-button__icon" aria-hidden="true">vpn_key</i>
                        <span class="mdc-button__label" id="loginingButton">Вхід</span>
                    </button>
                </div>
                <label class="mdc-text-field mdc-text-field--outlined" id="nameRegisterH" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" style="transform: translateY(-23px) scale(0.75);"  id="nameRegisterLabel">Логін у додатку</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="text" id="nameRegister" style="margin-top: 6px;"  class="mdc-text-field__input" required minlength="4">
                </label>
                <label class="mdc-text-field mdc-text-field--outlined" id="emailRegisterH" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" style="transform: translateY(-23px) scale(0.75);"  id="emailRegisterLabel">Email</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="text" id="emailRegister" class="mdc-text-field__input" style="margin-top: 6px;"  required pattern="[-a-zA-Z0-9~!$%^&amp;*_=+}{'?]+(\.[-a-zA-Z0-9~!$%^&amp;*_=+}{'?]+)*@([a-zA-Z0-9_][-a-zA-Z0-9_]*(\.[-a-zA-Z0-9_]+)*\.([cC][oO][mM]))(:[0-9]{1,5})?">
                </label>
                <label class="mdc-text-field mdc-text-field--outlined" id="passwordRegister1H" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" style="transform: translateY(-23px) scale(0.75);"  id="passwordRegister1Label">Пароль</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="password" id="passwordRegister1" class="mdc-text-field__input" style="margin-top: 6px;"  required minlength="8">
                </label>
                <label class="mdc-text-field mdc-text-field--outlined" id="passwordRegister2H" style="margin: 8px 16px;">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" style="transform: translateY(-23px) scale(0.75);"  id="passwordRegister2Label">Повторити пароль</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <input type="password" id="passwordRegister2" class="mdc-text-field__input" style="margin-top: 6px;"  required minlength="8">
                </label>
                <div class="mdc-form-field" style="margin-left: 8px;">
                    <div class="mdc-checkbox">
                        <input type="checkbox" class="mdc-checkbox__native-control" id="checkboxConsent"/>
                        <div class="mdc-checkbox__background">
                            <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
                                <path class="mdc-checkbox__checkmark-path" fill="none" d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
                            </svg>
                        <div class="mdc-checkbox__mixedmark"></div>
                        </div>
                        <div class="mdc-checkbox__ripple"></div>
                    </div>
                    <label for="checkboxConsent" id="checkboxConsentLabel">Я погоджуюся з <a target="_blank" href="https://google.com.ua">правилами користування</a> цього додатку</label>
                </div>
                <div role="progressbar" id="registerProgress" style="width: 100%; display: none;" class="mdc-linear-progress mdc-linear-progress--indeterminate" aria-label="Example Progress Bar" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0">
                    <div class="mdc-linear-progress__buffer">
                        <div class="mdc-linear-progress__buffer-bar"></div>
                        <div class="mdc-linear-progress__buffer-dots"></div>
                    </div>
                    <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
                        <span class="mdc-linear-progress__bar-inner"></spa>
                    </div>
                    <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
                        <span class="mdc-linear-progress__bar-inner"></span>
                    </div>
                </div>
                <p class="card__text" id="consoleRegister" style="color: #b00020; display: none;"></p>
                <div class="mdc-card__actions">
                    <div class="mdc-card__action-buttons" onclick="register()">
                        <button class="mdc-button mdc-card__action mdc-card__action--button" id="registerButtonB">
                            <div class="mdc-button__ripple"></div>
                            <span class="mdc-button__label" id='registerButton'>Зареєструватися</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class='mdc-card' id="cardSuccess" style="margin: 16px; background-color: #fff;">
                <div style="display: flex; flex-direction: column; margin: 16px; align-items: center;">
                    <div style="height: 256px; width: 256px; background-image: url('success.jpg'); background-size: contain;"></div>
                    <p class="card__text" id="successfulTitle" style="color: #000; width: 100%; text-align: center; font-size: 22px; font-weight: 600;"></p>
                    <p class="card__text" id="consoleSuccess" style="color: #333; width: 100%; text-align: justify;"></p>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        const localization = {
            loginingTitle: ['ВХІД', 'ВХОД', 'SIGNING IN'],
            registartionButton: ['Реєстрація', 'Регистрация', 'Registration'],
            emailLoginLabel: ['Email', 'Email', 'Email'],
            passwordLoginLabel: ['Пароль', 'Пароль', 'Password'],
            loginButton: ['Увійти', 'Войти', 'Sign in'],
            resetButton: ['Скинути пароль', 'Сбросить пароль', 'Reset password'],
            registartionTitle: ['РЕЄСТРАЦІЯ', 'РЕГИСТРАЦИЯ', 'REGISTRATION'],
            loginingButton: ['Вхід', 'Вход', 'Signing in'],
            nameRegisterLabel: ['Ім\'я у додатку', 'Имя в приложении', 'Name in app'],
            emailRegisterLabel: ['Email', 'Email', 'Email'],
            passwordRegister1Label: ['Пароль (8 знаків)', 'Пароль (8 знаков)', 'Password (8 symbols)'],
            passwordRegister2Label: ['Повторити пароль', 'Повторить пароль', 'Repeat password'],
            checkboxConsentLabel: ['Я погоджуюся з <a target="_blank" href="https://google.com.ua">правилами користування</a> цього додатку', 'Я соглашаюсь с <a target="_blank" href="https://google.com.ua">правилами пользования</a> этого приложения', 'I agree to the <a target="_blank" href="https://google.com.ua">terms of use</a> for this application'],
            registerButton: ['Зареєструватися', 'Зарегистрироваться', 'Register'],
            pageTitle: ['Мій успішний КРОК', 'Мой успешный КРОК', 'My successful KROK'],
            successfulTitle: ['Успішно!', 'Успешно!', 'Successfully!'],
        };

        let lang = 0;
        const selector = '.mdc-button, .mdc-fab, .mdc-icon-button, .mdc-card__primary-action, .mdc-icon-button';
        const ripples = [].map.call(document.querySelectorAll(selector), function (el) {
            return new mdc.ripple.MDCRipple(el);
        });
        const fields = [].map.call(document.querySelectorAll('.mdc-form-field'), function(el) {
            return new mdc.formField.MDCFormField(el);
        });
        const checks = [].map.call(document.querySelectorAll('.mdc-checkbox'), function(el) {
            return new mdc.checkbox.MDCCheckbox(el);
        });

        let type;
        let bucketId;
        let serverId;
        let userEmail;
        let code;

        const queryCard = document.getElementById('cardLogin');
        const successCard = document.getElementById('cardSuccess');
        //const firebaseApi = new FireBaseAPI();

        document.addEventListener('DOMContentLoaded', () => {
            let langI = 0;
            switch(new URLSearchParams(window.location.search).get('author')){
                case 'ru':
                    langI = 1;
                    break;
                case 'en':
                    langI = 2;
                    break;
                case 'ua':
                    langI = 0;
                    break;
            }
            localize(langI);
            if(getTheme() == 'dark'){
                document.body.classList.add('body__dark');
                document.getElementById('main').classList.add('main_fragment__dark');
                document.getElementById('icon').classList.add('icon__dark');
                document.getElementById('panel-top').style.boxShadow = 'box-shadow: 0px 0px 8px 4px #fff6;';
                let elems = document.querySelectorAll('.mdc-card');
                for(let i = 0; i < elems.length; i++) {
                    elems[i].style.boxShadow = '0px 2px 1px -1px rgb(255 255 255 / 20%), 0px 1px 1px 0px rgb(255 255 255 / 14%), 0px 1px 3px 0px rgb(255 255 255 / 12%) !important';
                };
            }
            else{
                document.body.classList.add('body__light');
                document.getElementById('main').classList.add('main_fragment__light');
                document.getElementById('icon').classList.add('icon__light');
                document.getElementById('panel-top').style.boxShadow = 'box-shadow: 0px 0px 8px 4px #0006;';
                let elems = document.querySelectorAll('.mdc-card');
                for(let i = 0; i < elems.length; i++) {
                    elems[i].style.boxShadow = '0px 2px 1px -1px rgb(0 0 0 / 20%), 0px 1px 1px 0px rgb(0 0 0 / 14%), 0px 1px 3px 0px rgb(0 0 0 / 12%) !important';
                };
            }
            changeCard(new URLSearchParams(window.location.search).get('action'));
        });

        function localize(langInt){
            lang = langInt;
            for(let str in localization){
                document.getElementById(str).innerHTML = localization[str][lang];
            }
            if(message !== ''){
                showMessage(message);
            }
        }

        function getTheme(){
            const url = new URLSearchParams(window.location.search).get('theme');
            if(url == null){
                const cookie = getCookie("theme");
                if(cookie == null){
                    document.cookie = 'theme=light';
                    return 'light';
                }
                return cookie;
            }
            document.cookie = 'theme=' + url;
            return url;
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2){
                return parts.pop().split(';').shift();
            } 
            return null;
        }

        function changeCard(localType){
            type = localType
            queryCard.style.display = 'none';
            successCard.style.display = 'none';
            switch(type){
                case 'accept':
                case 'reject':
                    code = new URLSearchParams(window.location.search).get('code');
                    successCard.style.display = 'flex';
                    if(type === 'reject' || getCookie('code') !== code){
                        //TODO draw reject
                    }
                    else{
                        //TODO draw success
                    }
                    break;
                case 'query':
                    userEmail = new URLSearchParams(window.location.search).get('userEmail');
                    bucketId = new URLSearchParams(window.location.search).get('bucketId');
                    serverId = new URLSearchParams(window.location.search).get('serverId');
                    queryCard.style.display = 'flex';
                    break;
            }
        }
    </script>
</body>

</html>